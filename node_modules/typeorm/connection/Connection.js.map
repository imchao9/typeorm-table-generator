{"version":3,"sources":["../../src/connection/Connection.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,uDAAoD;AAEpD,2EAAwE;AAExE,6EAA0E;AAC1E,iEAA8D;AAC9D,yFAAgH;AAChH,kCAAkE;AAClE,mFAAgF;AAChF,kFAA+E;AAC/E,+FAA4F;AAC5F,qFAAkF;AAClF,iGAA8F;AAG9F,mFAAgF;AAChF,yEAAsE;AAEtE,mFAAgF;AAChF,6GAA0G;AAC1G,yDAAsD;AACtD,6EAA0E;AAE1E,2EAAwE;AAExE,iEAA8D;AAE9D,2EAAwE;AACxE,wFAAqF;AAErF,oEAAiE;AACjE,mGAAgG;AAChG,2DAAwD;AACxD,uEAAoE;AACpE,mGAAgG;AAChG,+FAA4F;AAC5F,iIAA8H;AAE9H;;;GAGG;AACH;IA+FI,4EAA4E;IAC5E,cAAc;IACd,4EAA4E;IAE5E,oBAAY,IAAY,EAAE,MAAc,EAAE,MAAc;QA9ExD;;WAEG;QACa,oBAAe,GAAqB,EAAE,CAAC;QAgBvD;;WAEG;QACc,0BAAqB,GAA2B,EAAE,CAAC;QAEpE;;WAEG;QACc,uBAAkB,GAAa,EAAE,CAAC;QAEnD;;WAEG;QACc,oBAAe,GAA6B,EAAE,CAAC;QAEhE;;WAEG;QACc,sBAAiB,GAAqC,EAAE,CAAC;QAE1E;;WAEG;QACc,kBAAa,GAAe,EAAE,CAAC;QAEhD;;WAEG;QACc,kBAAa,GAAmB,EAAE,CAAC;QAEpD;;WAEG;QACc,sBAAiB,GAAe,EAAE,CAAC;QAEpD;;WAEG;QACc,0BAAqB,GAAe,EAAE,CAAC;QAExD;;WAEG;QACc,qBAAgB,GAAe,EAAE,CAAC;QAOnD;;WAEG;QACK,iBAAY,GAAG,KAAK,CAAC;QAOzB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,mBAAmB,EAAE,CAAC;QACjD,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAChD,CAAC;IASD,sBAAI,mCAAW;QAPf,4EAA4E;QAC5E,YAAY;QACZ,4EAA4E;QAE5E;;WAEG;aACH;YACI,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC;QAC7B,CAAC;;;OAAA;IAKD,sBAAI,qCAAa;QAHjB;;WAEG;aACH;YACI,yBAAyB;YACzB,oEAAoE;YAEpE,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC;QAC/B,CAAC;;;OAAA;IAED,4EAA4E;IAC5E,iBAAiB;IACjB,4EAA4E;IAE5E;;OAEG;IACG,4BAAO,GAAb;;;;;;wBACI,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;4BACjB,MAAM,IAAI,uEAAkC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;wBAE5D,yCAAyC;wBACzC,qBAAM,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,EAAA;;wBAD3B,yCAAyC;wBACzC,SAA2B,CAAC;wBAE5B,kDAAkD;wBAClD,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;;;;wBAIrB,IAAI,CAAC,cAAc,EAAE,CAAC;;;;wBAItB,qGAAqG;wBACrG,gCAAgC;wBAChC,qBAAM,IAAI,CAAC,KAAK,EAAE,EAAA;;wBAFlB,qGAAqG;wBACrG,gCAAgC;wBAChC,SAAkB,CAAC;wBACnB,MAAM,OAAK,CAAC;4BAGhB,sBAAO,IAAI,EAAC;;;;KACf;IAED;;;;OAIG;IACG,0BAAK,GAAX;;;;;wBACI,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;4BAClB,MAAM,IAAI,2DAA4B,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;wBAEtD,qBAAM,IAAI,CAAC,MAAM,CAAC,UAAU,EAAE,EAAA;;wBAA9B,SAA8B,CAAC;wBAC/B,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;;;;;KAC7B;IAED;;OAEG;IACG,iCAAY,GAAlB;;;;;4BACwB,qBAAM,IAAI,CAAC,MAAM,CAAC,iBAAiB,EAAE,EAAA;;sCAArC,SAAqC;wBACzD,qBAAM,WAAW,CAAC,aAAa,EAAE,EAAA;;wBAAjC,SAAiC,CAAC;;;;;KACrC;IAED;;;;OAIG;IACG,+BAAU,GAAhB,UAAiB,cAA+B;QAA/B,+BAAA,EAAA,sBAA+B;;;;;wBAE5C,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;4BAClB,MAAM,gBAAC,OAAO,CAAC,MAAM,CAAC,IAAI,yDAA2B,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAC;6BAElE,cAAc,EAAd,wBAAc;wBACd,qBAAM,IAAI,CAAC,YAAY,EAAE,EAAA;;wBAAzB,SAAyB,CAAC;;4BAE9B,qBAAM,IAAI,CAAC,mBAAmB,EAAE,CAAC,KAAK,EAAE,EAAA;;wBAAxC,SAAwC,CAAC;;;;;KAC5C;IAED;;OAEG;IACG,kCAAa,GAAnB;;gBAKU,iBAAiB;;;;wBAHvB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;4BAClB,MAAM,gBAAC,OAAO,CAAC,MAAM,CAAC,IAAI,yEAAmC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAC;4CAEpD,IAAI,qCAAiB,CAAC,IAAI,CAAC;wBACrD,qBAAM,iBAAiB,CAAC,wBAAwB,EAAE,EAAA;;wBAAlD,SAAkD,CAAC;;;;;KACtD;IAED;;OAEG;IACG,sCAAiB,GAAvB;;gBAKU,iBAAiB;;;;wBAHvB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;4BAClB,MAAM,gBAAC,OAAO,CAAC,MAAM,CAAC,IAAI,yEAAmC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAC;4CAEpD,IAAI,qCAAiB,CAAC,IAAI,CAAC;wBACrD,qBAAM,iBAAiB,CAAC,iBAAiB,EAAE,EAAA;;wBAA3C,SAA2C,CAAC;;;;;KAC/C;IAED;;OAEG;IACH,kDAA6B,GAA7B,UAA8B,KAAe;QACzC,IAAI,CAAC,cAAc,CAAC,6DAA4B,CAAC,KAAK,CAAC,CAAC,CAAC;QACzD,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAED;;OAEG;IACH,sDAAiC,GAAjC,UAAkC,KAAe;QAC7C,IAAI,CAAC,mBAAmB,CAAC,2DAA0B,CAAC,KAAK,CAAC,CAAC,CAAC;QAC5D,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAED;;OAEG;IACH,qDAAgC,GAAhC,UAAiC,KAAe;QAC5C,IAAI,CAAC,iBAAiB,CAAC,6DAA4B,CAAC,KAAK,CAAC,CAAC,CAAC;QAC5D,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAED;;OAEG;IACH,0DAAqC,GAArC,UAAsC,KAAe;QACjD,IAAI,CAAC,cAAc,CAAC,6DAA4B,CAAC,KAAK,CAAC,CAAC,CAAC;QACzD,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAED;;OAEG;IACH,oDAA+B,GAA/B,UAAgC,KAAe;QAC3C,IAAI,CAAC,gBAAgB,CAAC,6DAA4B,CAAC,KAAK,CAAC,CAAC,CAAC;QAC3D,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAED;;OAEG;IACH,mCAAc,GAAd,UAAe,QAAoB;QAAnC,iBAMC;QALG,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;YACjB,MAAM,IAAI,qEAAiC,CAAC,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;QAEvE,QAAQ,CAAC,OAAO,CAAC,UAAA,GAAG,IAAI,OAAA,KAAI,CAAC,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,EAA5B,CAA4B,CAAC,CAAC;QACtD,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAED;;OAEG;IACH,wCAAmB,GAAnB,UAAoB,OAAuB;QAA3C,iBAMC;QALG,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;YACjB,MAAM,IAAI,qEAAiC,CAAC,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;QAEtE,OAAO,CAAC,OAAO,CAAC,UAAA,MAAM,IAAI,OAAA,KAAI,CAAC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,EAA/B,CAA+B,CAAC,CAAC;QAC3D,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAED;;OAEG;IACH,sCAAiB,GAAjB,UAAkB,iBAA6B;QAA/C,iBAMC;QALG,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;YACjB,MAAM,IAAI,qEAAiC,CAAC,oBAAoB,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;QAEjF,iBAAiB,CAAC,OAAO,CAAC,UAAA,GAAG,IAAI,OAAA,KAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,GAAG,CAAC,EAAhC,CAAgC,CAAC,CAAC;QACnE,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAED;;OAEG;IACH,2CAAsB,GAAtB,UAAuB,UAAsB;QAA7C,iBAMC;QALG,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;YACjB,MAAM,IAAI,qEAAiC,CAAC,mBAAmB,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;QAEhF,UAAU,CAAC,OAAO,CAAC,UAAA,GAAG,IAAI,OAAA,KAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,GAAG,CAAC,EAApC,CAAoC,CAAC,CAAC;QAChE,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAED;;OAEG;IACH,qCAAgB,GAAhB,UAAiB,UAAsB;QAAvC,iBAMC;QALG,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;YACjB,MAAM,IAAI,qEAAiC,CAAC,YAAY,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;QAEzE,UAAU,CAAC,OAAO,CAAC,UAAA,GAAG,IAAI,OAAA,KAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,GAAG,CAAC,EAA/B,CAA+B,CAAC,CAAC;QAC3D,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAcD;;;OAGG;IACH,sCAAiB,GAAjB,UAAkB,mBAAoC;QAClD,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;YACjB,MAAM,IAAI,mFAAwC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAElE,IAAI,CAAC,kBAAkB,GAAG,mBAAmB,CAAC;QAC9C,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAiBD;;OAEG;IACH,gCAAW,GAAX,UAAY,MAAuB;QAC/B,IAAM,QAAQ,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,UAAA,QAAQ,IAAI,OAAA,QAAQ,CAAC,MAAM,KAAK,MAAM,IAAI,CAAC,OAAO,MAAM,KAAK,QAAQ,IAAI,QAAQ,CAAC,UAAU,KAAK,MAAM,CAAC,EAA5F,CAA4F,CAAC,CAAC;QACrJ,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC;YACV,MAAM,IAAI,+CAAsB,CAAC,MAAM,CAAC,CAAC;QAE7C,MAAM,CAAC,QAAQ,CAAC;IACpB,CAAC;IAiBD;;OAEG;IACH,kCAAa,GAAb,UAAsB,iBAA4C;QAC9D,MAAM,CAAC,IAAI,CAAC,wBAAwB,CAAC,iBAAiB,CAAC,CAAC,UAAU,CAAC;IACvE,CAAC;IAuBD;;;;OAIG;IACH,sCAAiB,GAAjB,UAA0B,iBAA4C;QAClE,IAAM,UAAU,GAAG,IAAI,CAAC,wBAAwB,CAAC,iBAAiB,CAAC,CAAC,cAAc,CAAC;QACnF,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC;YACZ,MAAM,IAAI,+CAAsB,CAAC,iBAAiB,CAAC,CAAC;QACxD,MAAM,CAAC,UAAU,CAAC;IACtB,CAAC;IAoBD;;;OAGG;IACH,0CAAqB,GAArB,UAA8B,iBAA4C;QACtE,MAAM,CAAC,IAAI,CAAC,wBAAwB,CAAC,iBAAiB,CAAC,CAAC,kBAAkB,CAAC;IAC/E,CAAC;IAED;;;;OAIG;IACH,oEAA+C,GAA/C,UAAgD,mBAAyC;QACrF,EAAE,CAAC,CAAC,CAAC,mBAAmB,CAAC;YACrB,mBAAmB,GAAG,IAAI,yCAAmB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QAErE,MAAM,CAAC,IAAI,6BAAa,CAAC,IAAI,EAAE,mBAAmB,CAAC,CAAC;IACxD,CAAC;IAED;;OAEG;IACH,kCAAa,GAAb;QACI,EAAE,CAAC,CAAC,IAAI,CAAC,gBAAgB,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC;YACxD,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,UAAA,cAAc;gBAC3C,MAAM,CAAC,wBAAgB,CAAqB,cAAc,CAAC,CAAC;YAChE,CAAC,CAAC,CAAC;QACP,CAAC;QAED,MAAM,CAAC,EAAE,CAAC;IACd,CAAC;IAED;;OAEG;IACH,wCAAmB,GAAnB,UAAuB,gBAA+B;QAClD,IAAM,4BAA4B,GAAG,8BAAsB,EAAE,CAAC,kBAAkB,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,UAAA,UAAU;YACtG,MAAM,CAAC,UAAU,CAAC,MAAM,KAAK,CAAC,gBAAgB,YAAY,QAAQ,GAAG,gBAAgB,GAAI,gBAAwB,CAAC,WAAW,CAAC,CAAC;QACnI,CAAC,CAAC,CAAC;QACH,EAAE,CAAC,CAAC,CAAC,4BAA4B,CAAC;YAC9B,MAAM,IAAI,6DAA6B,CAAC,gBAAgB,CAAC,CAAC;QAE9D,IAAI,wBAAwB,GAAQ,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,UAAA,gBAAgB,IAAI,OAAA,gBAAgB,CAAC,WAAW,KAAK,gBAAgB,EAAjD,CAAiD,CAAC,CAAC;QACxI,EAAE,CAAC,CAAC,CAAC,wBAAwB,CAAC,CAAC,CAAC;YAC5B,EAAE,CAAC,CAAC,4BAA4B,CAAC,YAAY,CAAC,CAAC,CAAC;gBAC5C,wBAAwB,GAAG,wBAAgB,CAAC,4BAA4B,CAAC,MAAM,CAAC,CAAC;gBAEjF,kGAAkG;gBAClG,6FAA6F;gBAC7F,sDAAsD;gBAEtD,EAAE,CAAC,CAAC,wBAAwB,YAAY,uCAAkB,IAAI,wBAAwB,YAAY,uBAAU,CAAC,CAAC,CAAC;oBAC3G,4HAA4H;oBAC5H,kEAAkE;oBAClE,EAAE,CAAC,CAAE,wBAAgC,CAAC,YAAY,CAAC,IAAK,wBAAgC,CAAC,YAAY,CAAC,KAAK,IAAI,CAAC;wBAC5G,MAAM,IAAI,yDAA2B,CAAC,gBAAgB,CAAC,CAAC;gBAChE,CAAC;YAEL,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,wBAAwB,GAAG,IAAK,4BAA4B,CAAC,MAAc,EAAE,CAAC;YAClF,CAAC;YAED,EAAE,CAAC,CAAC,wBAAwB,YAAY,uCAAkB,CAAC,CAAC,CAAC;gBACzD,4HAA4H;gBAC5H,kEAAkE;gBAClE,EAAE,CAAC,CAAC,CAAE,wBAAgC,CAAC,YAAY,CAAC,CAAC;oBAChD,wBAAgC,CAAC,YAAY,CAAC,GAAG,IAAI,CAAC;YAC/D,CAAC;YACD,EAAE,CAAC,CAAC,wBAAwB,YAAY,uBAAU,CAAC,CAAC,CAAC;gBACjD,EAAE,CAAC,CAAC,CAAC,4BAA4B,CAAC,MAAM,CAAC;oBACrC,MAAM,IAAI,2FAA4C,CAAC,gBAAgB,CAAC,CAAC;gBAE7E,4HAA4H;gBAC5H,kEAAkE;gBACjE,wBAAgC,CAAC,YAAY,CAAC,GAAG,IAAI,CAAC;gBACtD,wBAAgC,CAAC,UAAU,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,4BAA4B,CAAC,MAAM,CAAC,CAAC;YAC1G,CAAC;YAED,6BAA6B;YAC7B,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAC3D,CAAC;QAED,MAAM,CAAC,wBAAwB,CAAC;IACpC,CAAC;IAED;;;OAGG;IACH,8CAAyB,GAAzB,UAA6B,gBAAqB;QAC9C,IAAM,4BAA4B,GAAG,8BAAsB,EAAE,CAAC,kBAAkB,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,UAAA,UAAU;YACtG,MAAM,CAAC,UAAU,CAAC,MAAM,KAAK,CAAC,gBAAgB,YAAY,QAAQ,GAAG,gBAAgB,GAAI,gBAAwB,CAAC,WAAW,CAAC,CAAC;QACnI,CAAC,CAAC,CAAC;QACH,EAAE,CAAC,CAAC,CAAC,4BAA4B,CAAC;YAC9B,MAAM,IAAI,6DAA6B,CAAC,gBAAgB,CAAC,CAAC;QAE9D,MAAM,CAAC,4BAA4B,CAAC,MAAM,CAAC;IAC/C,CAAC;IAED,4EAA4E;IAC5E,oBAAoB;IACpB,4EAA4E;IAE5E;;OAEG;IACO,6CAAwB,GAAlC,UAAmC,iBAAyC;QACxE,yBAAyB;QACzB,2DAA2D;QAE3D,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,UAAA,QAAQ,IAAI,OAAA,QAAQ,CAAC,MAAM,KAAK,iBAAiB,IAAI,CAAC,OAAO,iBAAiB,KAAK,QAAQ,IAAI,QAAQ,CAAC,UAAU,KAAK,iBAAiB,CAAC,EAA7H,CAA6H,CAAC,CAAC;YACtK,MAAM,IAAI,iDAAuB,CAAC,IAAI,CAAC,IAAI,EAAE,iBAAiB,CAAC,CAAC;QAEpE,IAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,iBAAiB,CAAC,CAAC;QACrD,IAAM,oBAAoB,GAAG,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,UAAA,mBAAmB,IAAI,OAAA,mBAAmB,CAAC,QAAQ,KAAK,QAAQ,EAAzC,CAAyC,CAAC,CAAC;QAC/H,EAAE,CAAC,CAAC,CAAC,oBAAoB,CAAC;YACtB,MAAM,IAAI,iDAAuB,CAAC,IAAI,CAAC,IAAI,EAAE,iBAAiB,CAAC,CAAC;QAEpE,MAAM,CAAC,oBAAoB,CAAC;IAChC,CAAC;IAED;;OAEG;IACO,mCAAc,GAAxB;QAAA,iBAiDC;QA/CG,IAAI,CAAC,iBAAiB,CAAC,MAAM,GAAG,CAAC,CAAC;QAClC,IAAI,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC,CAAC;QAChC,IAAI,CAAC,qBAAqB,CAAC,MAAM,GAAG,CAAC,CAAC;QACtC,IAAI,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC,CAAC;QAEhC,IAAM,cAAc,GAAG,IAAI,CAAC,oBAAoB,EAAE,CAAC;QACnD,IAAI,CAAC,MAAM,CAAC,cAAc,GAAG,cAAc,CAAC;QAC5C,IAAM,oBAAoB,GAAG,IAAI,CAAC,0BAA0B,EAAE,CAAC;QAE/D,kCAAkC;QAClC,EAAE,CAAC,CAAC,IAAI,CAAC,iBAAiB,IAAI,IAAI,CAAC,iBAAiB,CAAC,MAAM,IAAI,CAAC,6BAAa,CAAC,cAAc,CAAC,0BAA0B,CAAC,CAAC,CAAC,CAAC;YACvH,8BAAsB,EAAE;iBACnB,iBAAiB;iBACjB,eAAe,CAAC,IAAI,CAAC,iBAAiB,CAAC;iBACvC,OAAO,EAAE;iBACT,GAAG,CAAC,UAAA,QAAQ,IAAI,OAAA,wBAAgB,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAjC,CAAiC,CAAC;iBAClD,OAAO,CAAC,UAAA,UAAU,IAAI,OAAA,KAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,UAAU,CAAC,EAAvC,CAAuC,CAAC,CAAC;QACxE,CAAC;QAED,iCAAiC;QACjC,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,CAAC;YAClD,8BAAsB,EAAE;iBACnB,eAAe;iBACf,eAAe,CAAC,IAAI,CAAC,aAAa,CAAC;iBACnC,OAAO,EAAE;iBACT,OAAO,CAAC,UAAA,QAAQ,IAAI,OAAA,KAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,+CAAsB,CAAC,QAAQ,CAAC,CAAC,EAA/D,CAA+D,CAAC,CAAC;QAC9F,CAAC;QAED,gFAAgF;QAChF,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,CAAC;YAClD,wBAAgB,CAAC,6CAAqB,CAAC;iBAClC,4BAA4B,CAAC,IAAI,CAAC,MAAM,EAAE,oBAAoB,EAAE,cAAc,EAAE,IAAI,CAAC,aAAa,CAAC;iBACnG,OAAO,CAAC,UAAA,QAAQ;gBACb,KAAI,CAAC,eAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gBACpC,KAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,IAAI,2CAAoB,CAAC,KAAI,EAAE,QAAQ,CAAC,CAAC,CAAC;YAC9E,CAAC,CAAC,CAAC;QACX,CAAC;QAED,mDAAmD;QACnD,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,CAAC;YAClD,wBAAgB,CAAC,6CAAqB,CAAC;iBAClC,gBAAgB,CAAC,IAAI,CAAC,MAAM,EAAE,oBAAoB,EAAE,cAAc,EAAE,IAAI,CAAC,aAAa,CAAC;iBACvF,OAAO,CAAC,UAAA,QAAQ;gBACb,KAAI,CAAC,eAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gBACpC,KAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,IAAI,2CAAoB,CAAC,KAAI,EAAE,QAAQ,CAAC,CAAC,CAAC;YAC9E,CAAC,CAAC,CAAC;QACX,CAAC;IACL,CAAC;IAED;;OAEG;IACO,yCAAoB,GAA9B;QAAA,iBAyBC;QAvBG,2GAA2G;QAC3G,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,qBAAqB,IAAI,CAAC,IAAI,CAAC,qBAAqB,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC;YAC9F,MAAM,CAAC,wBAAgB,CAAC,6CAAqB,CAAC,CAAC;QAEnD,2EAA2E;QAC3E,IAAM,cAAc,GAAG,8BAAsB,EAAE;aAC1C,gBAAgB;aAChB,eAAe,CAAC,IAAI,CAAC,qBAAqB,CAAC;aAC3C,OAAO,EAAE;aACT,IAAI,CAAC,UAAA,QAAQ;YACV,EAAE,CAAC,CAAC,OAAO,KAAI,CAAC,kBAAkB,KAAK,QAAQ,CAAC,CAAC,CAAC;gBAC9C,MAAM,CAAC,QAAQ,CAAC,IAAI,KAAK,KAAI,CAAC,kBAAkB,CAAC;YACrD,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,MAAM,CAAC,QAAQ,CAAC,MAAM,KAAK,KAAI,CAAC,kBAAkB,CAAC;YACvD,CAAC;QACL,CAAC,CAAC,CAAC;QAEP,8BAA8B;QAC9B,EAAE,CAAC,CAAC,CAAC,cAAc,CAAC;YAChB,MAAM,IAAI,yDAA2B,CAAC,IAAI,CAAC,kBAAkB,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;QAE9E,wCAAwC;QACxC,MAAM,CAAC,wBAAgB,CAA0B,cAAc,CAAC,MAAM,CAAC,CAAC;IAC5E,CAAC;IAED;;OAEG;IACO,wCAAmB,GAA7B;QACI,MAAM,CAAC,IAAI,6BAAa,CAAC,IAAI,CAAC,CAAC;IACnC,CAAC;IAED;;OAEG;IACO,sCAAiB,GAA3B;QACI,MAAM,CAAC,IAAI,yBAAW,CAAC,IAAI,EAAE,IAAI,CAAC,iBAAiB,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;IAC/E,CAAC;IAED;;OAEG;IACO,wCAAmB,GAA7B;QACI,MAAM,CAAC,IAAI,6BAAa,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;IAC7E,CAAC;IAED;;OAEG;IACO,+CAA0B,GAApC;QACI,MAAM,CAAC,IAAI,2CAAoB,CAAC,IAAI,CAAC,CAAC;IAC1C,CAAC;IAEL,iBAAC;AAAD,CAjqBA,AAiqBC,IAAA;AAjqBY,gCAAU","file":"Connection.js","sourcesContent":["import {Driver} from \"../driver/Driver\";\nimport {Repository} from \"../repository/Repository\";\nimport {EntitySubscriberInterface} from \"../subscriber/EntitySubscriberInterface\";\nimport {RepositoryNotFoundError} from \"./error/RepositoryNotFoundError\";\nimport {ObjectType} from \"../common/ObjectType\";\nimport {EntityListenerMetadata} from \"../metadata/EntityListenerMetadata\";\nimport {EntityManager} from \"../entity-manager/EntityManager\";\nimport {importClassesFromDirectories, importJsonsFromDirectories} from \"../util/DirectoryExportedClassesLoader\";\nimport {getMetadataArgsStorage, getFromContainer} from \"../index\";\nimport {EntityMetadataBuilder} from \"../metadata-builder/EntityMetadataBuilder\";\nimport {DefaultNamingStrategy} from \"../naming-strategy/DefaultNamingStrategy\";\nimport {CannotImportAlreadyConnectedError} from \"./error/CannotImportAlreadyConnectedError\";\nimport {CannotCloseNotConnectedError} from \"./error/CannotCloseNotConnectedError\";\nimport {CannotConnectAlreadyConnectedError} from \"./error/CannotConnectAlreadyConnectedError\";\nimport {TreeRepository} from \"../repository/TreeRepository\";\nimport {NamingStrategyInterface} from \"../naming-strategy/NamingStrategyInterface\";\nimport {NamingStrategyNotFoundError} from \"./error/NamingStrategyNotFoundError\";\nimport {RepositoryNotTreeError} from \"./error/RepositoryNotTreeError\";\nimport {EntitySchema} from \"../entity-schema/EntitySchema\";\nimport {CannotSyncNotConnectedError} from \"./error/CannotSyncNotConnectedError\";\nimport {CannotUseNamingStrategyNotConnectedError} from \"./error/CannotUseNamingStrategyNotConnectedError\";\nimport {Broadcaster} from \"../subscriber/Broadcaster\";\nimport {LazyRelationsWrapper} from \"../lazy-loading/LazyRelationsWrapper\";\nimport {SpecificRepository} from \"../repository/SpecificRepository\";\nimport {RepositoryAggregator} from \"../repository/RepositoryAggregator\";\nimport {EntityMetadata} from \"../metadata/EntityMetadata\";\nimport {SchemaBuilder} from \"../schema-builder/SchemaBuilder\";\nimport {Logger} from \"../logger/Logger\";\nimport {QueryRunnerProvider} from \"../query-runner/QueryRunnerProvider\";\nimport {EntityMetadataNotFound} from \"../metadata-args/error/EntityMetadataNotFound\";\nimport {MigrationInterface} from \"../migration/MigrationInterface\";\nimport {MigrationExecutor} from \"../migration/MigrationExecutor\";\nimport {CannotRunMigrationNotConnectedError} from \"./error/CannotRunMigrationNotConnectedError\";\nimport {PlatformTools} from \"../platform/PlatformTools\";\nimport {AbstractRepository} from \"../repository/AbstractRepository\";\nimport {CustomRepositoryNotFoundError} from \"../repository/error/CustomRepositoryNotFoundError\";\nimport {CustomRepositoryReusedError} from \"../repository/error/CustomRepositoryReusedError\";\nimport {CustomRepositoryCannotInheritRepositoryError} from \"../repository/error/CustomRepositoryCannotInheritRepositoryError\";\n\n/**\n * Connection is a single database connection to a specific database of a database management system.\n * You can have multiple connections to multiple databases in your application.\n */\nexport class Connection {\n\n    // -------------------------------------------------------------------------\n    // Public Readonly properties\n    // -------------------------------------------------------------------------\n\n    /**\n     * Connection name.\n     */\n    public readonly name: string;\n\n    /**\n     * Database driver used by this connection.\n     */\n    public readonly driver: Driver;\n\n    /**\n     * Logger used to log orm events.\n     */\n    public readonly logger: Logger;\n\n    /**\n     * All entity metadatas that are registered for this connection.\n     */\n    public readonly entityMetadatas: EntityMetadata[] = [];\n\n    /**\n     * Used to broadcast connection events.\n     */\n    public readonly broadcaster: Broadcaster;\n\n    // -------------------------------------------------------------------------\n    // Private Properties\n    // -------------------------------------------------------------------------\n\n    /**\n     * Gets EntityManager of this connection.\n     */\n    private readonly _entityManager: EntityManager;\n\n    /**\n     * Stores all registered repositories.\n     */\n    private readonly repositoryAggregators: RepositoryAggregator[] = [];\n\n    /**\n     * Stores all entity repository instances.\n     */\n    private readonly entityRepositories: Object[] = [];\n\n    /**\n     * Entity listeners that are registered for this connection.\n     */\n    private readonly entityListeners: EntityListenerMetadata[] = [];\n\n    /**\n     * Entity subscribers that are registered for this connection.\n     */\n    private readonly entitySubscribers: EntitySubscriberInterface<any>[] = [];\n\n    /**\n     * Registered entity classes to be used for this connection.\n     */\n    private readonly entityClasses: Function[] = [];\n\n    /**\n     * Registered entity schemas to be used for this connection.\n     */\n    private readonly entitySchemas: EntitySchema[] = [];\n\n    /**\n     * Registered subscriber classes to be used for this connection.\n     */\n    private readonly subscriberClasses: Function[] = [];\n\n    /**\n     * Registered naming strategy classes to be used for this connection.\n     */\n    private readonly namingStrategyClasses: Function[] = [];\n\n    /**\n     * Registered migration classes to be used for this connection.\n     */\n    private readonly migrationClasses: Function[] = [];\n\n    /**\n     * Naming strategy to be used in this connection.\n     */\n    private usedNamingStrategy: Function|string;\n\n    /**\n     * Indicates if connection has been done or not.\n     */\n    private _isConnected = false;\n\n    // -------------------------------------------------------------------------\n    // Constructor\n    // -------------------------------------------------------------------------\n\n    constructor(name: string, driver: Driver, logger: Logger) {\n        this.name = name;\n        this.driver = driver;\n        this.logger = logger;\n        this._entityManager = this.createEntityManager();\n        this.broadcaster = this.createBroadcaster();\n    }\n\n    // -------------------------------------------------------------------------\n    // Accessors\n    // -------------------------------------------------------------------------\n\n    /**\n     * Indicates if connection to the database already established for this connection.\n     */\n    get isConnected() {\n        return this._isConnected;\n    }\n\n    /**\n     * Gets entity manager that allows to perform repository operations with any entity in this connection.\n     */\n    get entityManager() {\n        // if (!this.isConnected)\n        //     throw new CannotGetEntityManagerNotConnectedError(this.name);\n\n        return this._entityManager;\n    }\n\n    // -------------------------------------------------------------------------\n    // Public Methods\n    // -------------------------------------------------------------------------\n\n    /**\n     * Performs connection to the database.\n     */\n    async connect(): Promise<this> {\n        if (this.isConnected)\n            throw new CannotConnectAlreadyConnectedError(this.name);\n\n        // connect to the database via its driver\n        await this.driver.connect();\n\n        // set connected status for the current connection\n        this._isConnected = true;\n\n        // build all metadatas registered in the current connection\n        try {\n            this.buildMetadatas();\n\n        } catch (error) {\n\n            // if for some reason build metadata fail (for example validation error during entity metadata check)\n            // connection needs to be closed\n            await this.close();\n            throw error;\n        }\n\n        return this;\n    }\n\n    /**\n     * Closes connection with the database.\n     * Once connection is closed, you cannot use repositories and perform any operations except\n     * opening connection again.\n     */\n    async close(): Promise<void> {\n        if (!this.isConnected)\n            throw new CannotCloseNotConnectedError(this.name);\n\n        await this.driver.disconnect();\n        this._isConnected = false;\n    }\n\n    /**\n     * Drops the database and all its data.\n     */\n    async dropDatabase(): Promise<void> {\n        const queryRunner = await this.driver.createQueryRunner();\n        await queryRunner.clearDatabase();\n    }\n\n    /**\n     * Creates database schema for all entities registered in this connection.\n     *\n     * @param dropBeforeSync If set to true then it drops the database with all its tables and data\n     */\n    async syncSchema(dropBeforeSync: boolean = false): Promise<void> {\n\n        if (!this.isConnected)\n            return Promise.reject(new CannotSyncNotConnectedError(this.name));\n\n        if (dropBeforeSync)\n            await this.dropDatabase();\n\n        await this.createSchemaBuilder().build();\n    }\n\n    /**\n     * Runs all pending migrations.\n     */\n    async runMigrations(): Promise<void> {\n\n        if (!this.isConnected)\n            return Promise.reject(new CannotRunMigrationNotConnectedError(this.name));\n\n        const migrationExecutor = new MigrationExecutor(this);\n        await migrationExecutor.executePendingMigrations();\n    }\n\n    /**\n     * Reverts last executed migration.\n     */\n    async undoLastMigration(): Promise<void> {\n\n        if (!this.isConnected)\n            return Promise.reject(new CannotRunMigrationNotConnectedError(this.name));\n\n        const migrationExecutor = new MigrationExecutor(this);\n        await migrationExecutor.undoLastMigration();\n    }\n\n    /**\n     * Imports entities from the given paths (directories) and registers them in the current connection.\n     */\n    importEntitiesFromDirectories(paths: string[]): this {\n        this.importEntities(importClassesFromDirectories(paths));\n        return this;\n    }\n\n    /**\n     * Imports entity schemas from the given paths (directories) and registers them in the current connection.\n     */\n    importEntitySchemaFromDirectories(paths: string[]): this {\n        this.importEntitySchemas(importJsonsFromDirectories(paths));\n        return this;\n    }\n\n    /**\n     * Imports subscribers from the given paths (directories) and registers them in the current connection.\n     */\n    importSubscribersFromDirectories(paths: string[]): this {\n        this.importSubscribers(importClassesFromDirectories(paths));\n        return this;\n    }\n\n    /**\n     * Imports naming strategies from the given paths (directories) and registers them in the current connection.\n     */\n    importNamingStrategiesFromDirectories(paths: string[]): this {\n        this.importEntities(importClassesFromDirectories(paths));\n        return this;\n    }\n\n    /**\n     * Imports migrations from the given paths (directories) and registers them in the current connection.\n     */\n    importMigrationsFromDirectories(paths: string[]): this {\n        this.importMigrations(importClassesFromDirectories(paths));\n        return this;\n    }\n\n    /**\n     * Imports entities and registers them in the current connection.\n     */\n    importEntities(entities: Function[]): this {\n        if (this.isConnected)\n            throw new CannotImportAlreadyConnectedError(\"entities\", this.name);\n\n        entities.forEach(cls => this.entityClasses.push(cls));\n        return this;\n    }\n\n    /**\n     * Imports schemas and registers them in the current connection.\n     */\n    importEntitySchemas(schemas: EntitySchema[]): this {\n        if (this.isConnected)\n            throw new CannotImportAlreadyConnectedError(\"schemas\", this.name);\n\n        schemas.forEach(schema => this.entitySchemas.push(schema));\n        return this;\n    }\n\n    /**\n     * Imports subscribers and registers them in the current connection.\n     */\n    importSubscribers(subscriberClasses: Function[]): this {\n        if (this.isConnected)\n            throw new CannotImportAlreadyConnectedError(\"entity subscribers\", this.name);\n\n        subscriberClasses.forEach(cls => this.subscriberClasses.push(cls));\n        return this;\n    }\n\n    /**\n     * Imports naming strategies and registers them in the current connection.\n     */\n    importNamingStrategies(strategies: Function[]): this {\n        if (this.isConnected)\n            throw new CannotImportAlreadyConnectedError(\"naming strategies\", this.name);\n\n        strategies.forEach(cls => this.namingStrategyClasses.push(cls));\n        return this;\n    }\n\n    /**\n     * Imports migrations and registers them in the current connection.\n     */\n    importMigrations(migrations: Function[]): this {\n        if (this.isConnected)\n            throw new CannotImportAlreadyConnectedError(\"migrations\", this.name);\n\n        migrations.forEach(cls => this.migrationClasses.push(cls));\n        return this;\n    }\n\n    /**\n     * Sets given naming strategy to be used.\n     * Naming strategy must be set to be used before connection is established.\n     */\n    useNamingStrategy(name: string): this;\n\n    /**\n     * Sets given naming strategy to be used.\n     * Naming strategy must be set to be used before connection is established.\n     */\n    useNamingStrategy(strategy: Function): this;\n\n    /**\n     * Sets given naming strategy to be used.\n     * Naming strategy must be set to be used before connection is established.\n     */\n    useNamingStrategy(strategyClassOrName: string|Function): this {\n        if (this.isConnected)\n            throw new CannotUseNamingStrategyNotConnectedError(this.name);\n\n        this.usedNamingStrategy = strategyClassOrName;\n        return this;\n    }\n\n    /**\n     * Gets the entity metadata of the given entity class.\n     */\n    getMetadata(target: Function): EntityMetadata;\n\n    /**\n     * Gets the entity metadata of the given entity name.\n     */\n    getMetadata(target: string): EntityMetadata;\n\n    /**\n     * Gets the entity metadata of the given entity class or schema name.\n     */\n    getMetadata(target: Function|string): EntityMetadata;\n\n    /**\n     Gets entity metadata for the given entity class or schema name.\n     */\n    getMetadata(target: Function|string): EntityMetadata {\n        const metadata = this.entityMetadatas.find(metadata => metadata.target === target || (typeof target === \"string\" && metadata.targetName === target));\n        if (!metadata)\n            throw new EntityMetadataNotFound(target);\n\n        return metadata;\n    }\n\n    /**\n     * Gets repository for the given entity class.\n     */\n    getRepository<Entity>(entityClass: ObjectType<Entity>): Repository<Entity>;\n\n    /**\n     * Gets repository for the given entity name.\n     */\n    getRepository<Entity>(entityName: string): Repository<Entity>;\n\n    /**\n     * Gets repository for the given entity name.\n     */\n    getRepository<Entity>(entityClassOrName: ObjectType<Entity>|string): Repository<Entity>;\n\n    /**\n     * Gets repository for the given entity class or name.\n     */\n    getRepository<Entity>(entityClassOrName: ObjectType<Entity>|string): Repository<Entity> {\n        return this.findRepositoryAggregator(entityClassOrName).repository;\n    }\n\n    /**\n     * Gets tree repository for the given entity class.\n     * Only tree-type entities can have a TreeRepository,\n     * like ones decorated with @ClosureEntity decorator.\n     */\n    getTreeRepository<Entity>(entityClass: ObjectType<Entity>): TreeRepository<Entity>;\n\n    /**\n     * Gets tree repository for the given entity class.\n     * Only tree-type entities can have a TreeRepository,\n     * like ones decorated with @ClosureEntity decorator.\n     */\n    getTreeRepository<Entity>(entityClassOrName: ObjectType<Entity>|string): TreeRepository<Entity>;\n\n    /**\n     * Gets tree repository for the given entity class.\n     * Only tree-type entities can have a TreeRepository,\n     * like ones decorated with @ClosureEntity decorator.\n     */\n    getTreeRepository<Entity>(entityName: string): TreeRepository<Entity>;\n\n    /**\n     * Gets tree repository for the given entity class or name.\n     * Only tree-type entities can have a TreeRepository,\n     * like ones decorated with @ClosureEntity decorator.\n     */\n    getTreeRepository<Entity>(entityClassOrName: ObjectType<Entity>|string): TreeRepository<Entity> {\n        const repository = this.findRepositoryAggregator(entityClassOrName).treeRepository;\n        if (!repository)\n            throw new RepositoryNotTreeError(entityClassOrName);\n        return repository;\n    }\n\n    /**\n     * Gets specific repository for the given entity class.\n     * SpecificRepository is a special repository that contains specific and non standard repository methods.\n     */\n    getSpecificRepository<Entity>(entityClass: ObjectType<Entity>): SpecificRepository<Entity>;\n\n    /**\n     * Gets specific repository for the given entity name.\n     * SpecificRepository is a special repository that contains specific and non standard repository methods.\n     */\n    getSpecificRepository<Entity>(entityName: string): SpecificRepository<Entity>;\n\n    /**\n     * Gets specific repository for the given entity class or name.\n     * SpecificRepository is a special repository that contains specific and non standard repository methods.\n     */\n    getSpecificRepository<Entity>(entityClassOrName: ObjectType<Entity>|string): SpecificRepository<Entity>;\n\n    /**\n     * Gets specific repository for the given entity class or name.\n     * SpecificRepository is a special repository that contains specific and non standard repository methods.\n     */\n    getSpecificRepository<Entity>(entityClassOrName: ObjectType<Entity>|string): SpecificRepository<Entity> {\n        return this.findRepositoryAggregator(entityClassOrName).specificRepository;\n    }\n\n    /**\n     * Creates a new entity manager with a single opened connection to the database.\n     * This may be useful if you want to perform all db queries within one connection.\n     * After finishing with entity manager, don't forget to release it, to release connection back to pool.\n     */\n    createEntityManagerWithSingleDatabaseConnection(queryRunnerProvider?: QueryRunnerProvider): EntityManager {\n        if (!queryRunnerProvider)\n            queryRunnerProvider = new QueryRunnerProvider(this.driver, true);\n\n        return new EntityManager(this, queryRunnerProvider);\n    }\n\n    /**\n     * Gets migration instances that are registered for this connection.\n     */\n    getMigrations(): MigrationInterface[] {\n        if (this.migrationClasses && this.migrationClasses.length) {\n            return this.migrationClasses.map(migrationClass => {\n                return getFromContainer<MigrationInterface>(migrationClass);\n            });\n        }\n\n        return [];\n    }\n\n    /**\n     * Gets custom entity repository marked with @EntityRepository decorator.\n     */\n    getCustomRepository<T>(customRepository: ObjectType<T>): T {\n        const entityRepositoryMetadataArgs = getMetadataArgsStorage().entityRepositories.toArray().find(repository => {\n            return repository.target === (customRepository instanceof Function ? customRepository : (customRepository as any).constructor);\n        });\n        if (!entityRepositoryMetadataArgs)\n            throw new CustomRepositoryNotFoundError(customRepository);\n\n        let entityRepositoryInstance: any = this.entityRepositories.find(entityRepository => entityRepository.constructor === customRepository);\n        if (!entityRepositoryInstance) {\n            if (entityRepositoryMetadataArgs.useContainer) {\n                entityRepositoryInstance = getFromContainer(entityRepositoryMetadataArgs.target);\n\n                // if we get custom entity repository from container then there is a risk that it already was used\n                // in some different connection. If it was used there then we check it and throw an exception\n                // because we cant override its connection there again\n\n                if (entityRepositoryInstance instanceof AbstractRepository || entityRepositoryInstance instanceof Repository) {\n                    // NOTE: dynamic access to protected properties. We need this to prevent unwanted properties in those classes to be exposed,\n                    // however we need these properties for internal work of the class\n                    if ((entityRepositoryInstance as any)[\"connection\"] && (entityRepositoryInstance as any)[\"connection\"] !== this)\n                        throw new CustomRepositoryReusedError(customRepository);\n                }\n\n            } else {\n                entityRepositoryInstance = new (entityRepositoryMetadataArgs.target as any)();\n            }\n\n            if (entityRepositoryInstance instanceof AbstractRepository) {\n                // NOTE: dynamic access to protected properties. We need this to prevent unwanted properties in those classes to be exposed,\n                // however we need these properties for internal work of the class\n                if (!(entityRepositoryInstance as any)[\"connection\"])\n                    (entityRepositoryInstance as any)[\"connection\"] = this;\n            }\n            if (entityRepositoryInstance instanceof Repository) {\n                if (!entityRepositoryMetadataArgs.entity)\n                    throw new CustomRepositoryCannotInheritRepositoryError(customRepository);\n\n                // NOTE: dynamic access to protected properties. We need this to prevent unwanted properties in those classes to be exposed,\n                // however we need these properties for internal work of the class\n                (entityRepositoryInstance as any)[\"connection\"] = this;\n                (entityRepositoryInstance as any)[\"metadata\"] = this.getMetadata(entityRepositoryMetadataArgs.entity);\n            }\n\n            // register entity repository\n            this.entityRepositories.push(entityRepositoryInstance);\n        }\n\n        return entityRepositoryInstance;\n    }\n\n    /**\n     * Gets custom repository's managed entity.\n     * If given custom repository does not manage any entity then undefined will be returned.\n     */\n    getCustomRepositoryTarget<T>(customRepository: any): Function|string|undefined {\n        const entityRepositoryMetadataArgs = getMetadataArgsStorage().entityRepositories.toArray().find(repository => {\n            return repository.target === (customRepository instanceof Function ? customRepository : (customRepository as any).constructor);\n        });\n        if (!entityRepositoryMetadataArgs)\n            throw new CustomRepositoryNotFoundError(customRepository);\n\n        return entityRepositoryMetadataArgs.entity;\n    }\n\n    // -------------------------------------------------------------------------\n    // Protected Methods\n    // -------------------------------------------------------------------------\n\n    /**\n     * Finds repository aggregator of the given entity class or name.\n     */\n    protected findRepositoryAggregator(entityClassOrName: ObjectType<any>|string): RepositoryAggregator {\n        // if (!this.isConnected)\n        //     throw new NoConnectionForRepositoryError(this.name);\n\n        if (!this.entityMetadatas.find(metadata => metadata.target === entityClassOrName || (typeof entityClassOrName === \"string\" && metadata.targetName === entityClassOrName)))\n            throw new RepositoryNotFoundError(this.name, entityClassOrName);\n\n        const metadata = this.getMetadata(entityClassOrName);\n        const repositoryAggregator = this.repositoryAggregators.find(repositoryAggregate => repositoryAggregate.metadata === metadata);\n        if (!repositoryAggregator)\n            throw new RepositoryNotFoundError(this.name, entityClassOrName);\n\n        return repositoryAggregator;\n    }\n\n    /**\n     * Builds all registered metadatas.\n     */\n    protected buildMetadatas() {\n\n        this.entitySubscribers.length = 0;\n        this.entityListeners.length = 0;\n        this.repositoryAggregators.length = 0;\n        this.entityMetadatas.length = 0;\n\n        const namingStrategy = this.createNamingStrategy();\n        this.driver.namingStrategy = namingStrategy;\n        const lazyRelationsWrapper = this.createLazyRelationsWrapper();\n\n        // take imported event subscribers\n        if (this.subscriberClasses && this.subscriberClasses.length && !PlatformTools.getEnvVariable(\"SKIP_SUBSCRIBERS_LOADING\")) {\n            getMetadataArgsStorage()\n                .entitySubscribers\n                .filterByTargets(this.subscriberClasses)\n                .toArray()\n                .map(metadata => getFromContainer(metadata.target))\n                .forEach(subscriber => this.entitySubscribers.push(subscriber));\n        }\n\n        // take imported entity listeners\n        if (this.entityClasses && this.entityClasses.length) {\n            getMetadataArgsStorage()\n                .entityListeners\n                .filterByTargets(this.entityClasses)\n                .toArray()\n                .forEach(metadata => this.entityListeners.push(new EntityListenerMetadata(metadata)));\n        }\n\n        // build entity metadatas from metadata args storage (collected from decorators)\n        if (this.entityClasses && this.entityClasses.length) {\n            getFromContainer(EntityMetadataBuilder)\n                .buildFromMetadataArgsStorage(this.driver, lazyRelationsWrapper, namingStrategy, this.entityClasses)\n                .forEach(metadata => {\n                    this.entityMetadatas.push(metadata);\n                    this.repositoryAggregators.push(new RepositoryAggregator(this, metadata));\n                });\n        }\n\n        // build entity metadatas from given entity schemas\n        if (this.entitySchemas && this.entitySchemas.length) {\n            getFromContainer(EntityMetadataBuilder)\n                .buildFromSchemas(this.driver, lazyRelationsWrapper, namingStrategy, this.entitySchemas)\n                .forEach(metadata => {\n                    this.entityMetadatas.push(metadata);\n                    this.repositoryAggregators.push(new RepositoryAggregator(this, metadata));\n                });\n        }\n    }\n\n    /**\n     * Creates a naming strategy to be used for this connection.\n     */\n    protected createNamingStrategy(): NamingStrategyInterface {\n\n        // if naming strategies are not loaded, or used naming strategy is not set then use default naming strategy\n        if (!this.namingStrategyClasses || !this.namingStrategyClasses.length || !this.usedNamingStrategy)\n            return getFromContainer(DefaultNamingStrategy);\n\n        // try to find used naming strategy in the list of loaded naming strategies\n        const namingMetadata = getMetadataArgsStorage()\n            .namingStrategies\n            .filterByTargets(this.namingStrategyClasses)\n            .toArray()\n            .find(strategy => {\n                if (typeof this.usedNamingStrategy === \"string\") {\n                    return strategy.name === this.usedNamingStrategy;\n                } else {\n                    return strategy.target === this.usedNamingStrategy;\n                }\n            });\n\n        // throw an error if not found\n        if (!namingMetadata)\n            throw new NamingStrategyNotFoundError(this.usedNamingStrategy, this.name);\n\n        // initialize a naming strategy instance\n        return getFromContainer<NamingStrategyInterface>(namingMetadata.target);\n    }\n\n    /**\n     * Creates a new default entity manager without single connection setup.\n     */\n    protected createEntityManager() {\n        return new EntityManager(this);\n    }\n\n    /**\n     * Creates a new entity broadcaster using in this connection.\n     */\n    protected createBroadcaster() {\n        return new Broadcaster(this, this.entitySubscribers, this.entityListeners);\n    }\n\n    /**\n     * Creates a schema builder used to build a database schema for the entities of the current connection.\n     */\n    protected createSchemaBuilder() {\n        return new SchemaBuilder(this.driver, this.logger, this.entityMetadatas);\n    }\n\n    /**\n     * Creates a lazy relations wrapper.\n     */\n    protected createLazyRelationsWrapper() {\n        return new LazyRelationsWrapper(this);\n    }\n\n}"],"sourceRoot":".."}